// RUN: llzk-opt -split-input-file %s 2>&1 | FileCheck %s

module attributes {veridise.lang = "llzk"} {

  llzk.struct @Subcomponent {
    func @compute() -> !llzk.struct<@Subcomponent> {
      %self = new_struct : !llzk.struct<@Subcomponent>
      return %self : !llzk.struct<@Subcomponent>
    }
    func @constrain(%self: !llzk.struct<@Subcomponent>) { return }
  }

  llzk.struct @Component {
    field @sub1 : !llzk.struct<@Subcomponent>
    field @sub2 : !llzk.struct<@Subcomponent>

    func @compute() -> !llzk.struct<@Component> {
      %self = new_struct : !llzk.struct<@Component>
      %sub1 = readf %self[@sub1] : !llzk.struct<@Component>, !llzk.struct<@Subcomponent>
      %sub2 = readf %self[@sub2] : !llzk.struct<@Component>, !llzk.struct<@Subcomponent>
      %sub3 = readf %self[@sub2] : !llzk.struct<@Component>, !llzk.struct<@Subcomponent>
      return %self : !llzk.struct<@Component>
    }
    func @constrain(%self: !llzk.struct<@Component>) { return }
  }
}