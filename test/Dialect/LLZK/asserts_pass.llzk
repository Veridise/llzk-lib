// RUN: llzk-opt -split-input-file %s 2>&1 | FileCheck %s

module attributes {veridise.lang = "llzk"} {
  llzk.struct @Component01<[@C]> {
    func @compute(%a: !llzk.felt) -> !llzk.struct<@Component01<[@C]>> {
      %self = new_struct : !llzk.struct<@Component01<[@C]>>
      %b = read_const @C : !llzk.felt
      %c = cmp gt(%a, %b)
      %0 = assert %c : !llzk.felt
      return %self : !llzk.struct<@Component01<[@C]>>
    }

    func @constrain(%self: !llzk.struct<@Component01<[@C]>>, %a: !llzk.felt) {
      %b = read_const @C : !llzk.felt
      %c = cmp gt(%a, %b)
      %0 = assert %c : !llzk.felt
      return
    }
  }
}
//CHECK-LABEL: llzk.struct @Component01<[@C]> {
//CHECK-NEXT:    func @compute(%[[A0:[0-9a-zA-Z_\.]+]]: !llzk.felt) -> !llzk.struct<@Component01<[@C]>> {
//CHECK-NEXT:      %[[SELF:[0-9a-zA-Z_\.]+]] = new_struct : <@Component01<[@C]>>
//CHECK-NEXT:      %[[T0:[0-9a-zA-Z_\.]+]] = read_const @C : !llzk.felt
//CHECK-NEXT:      %[[T1:[0-9a-zA-Z_\.]+]] = cmp gt(%[[A0]], %[[T0]])
//CHECK-NEXT:      %[[T2:[0-9a-zA-Z_\.]+]] = assert %[[T1]] : !llzk.felt
//CHECK-NEXT:      return %[[SELF]] : !llzk.struct<@Component01<[@C]>>
//CHECK-NEXT:    }
//CHECK-NEXT:    func @constrain(%[[SELF:[0-9a-zA-Z_\.]+]]: !llzk.struct<@Component01<[@C]>>, %[[A1:[0-9a-zA-Z_\.]+]]: !llzk.felt) {
//CHECK-NEXT:      %[[T0:[0-9a-zA-Z_\.]+]] = read_const @C : !llzk.felt
//CHECK-NEXT:      %[[T1:[0-9a-zA-Z_\.]+]] = cmp gt(%[[A1]], %[[T0]])
//CHECK-NEXT:      %[[T2:[0-9a-zA-Z_\.]+]] = assert %[[T1]] : !llzk.felt
//CHECK-NEXT:      return
//CHECK-NEXT:    }
//CHECK-NEXT:  }
// -----

llzk.func @test_in_global_func(%a: !llzk.felt, %b: !llzk.felt) -> i1 {
  %c = cmp gt(%a, %b)
  %0 = assert %c : !llzk.felt
  return %c : i1
}
//CHECK-LABEL: llzk.func @test_in_global_func
//CHECK-SAME:  (%[[A0:[0-9a-zA-Z_\.]+]]: !llzk.felt, %[[A1:[0-9a-zA-Z_\.]+]]: !llzk.felt) -> i1 {
//CHECK-NEXT:    %[[T0:[0-9a-zA-Z_\.]+]] = cmp gt(%[[A0]], %[[A1]])
//CHECK-NEXT:    %[[T1:[0-9a-zA-Z_\.]+]] = assert %[[T0]] : !llzk.felt
//CHECK-NEXT:    return %[[T0]] : i1
//CHECK-NEXT:  }
// -----

llzk.func @just_assert(%c: i1) -> i1 {
  %0 = assert %c : !llzk.felt
  return %c : i1
}
//CHECK-LABEL: llzk.func @just_assert
//CHECK-SAME:  (%[[A:[0-9a-zA-Z_\.]+]]: i1) -> i1 {
//CHECK-NEXT:    %[[T0:[0-9a-zA-Z_\.]+]] = assert %[[A]] : !llzk.felt
//CHECK-NEXT:    return %[[A]] : i1
//CHECK-NEXT:  }
// -----

llzk.func @assert_with_message(%c: i1) -> i1 {
  %0 = assert %c, "Expected a `true` value" : !llzk.felt
  return %c : i1
}
//CHECK-LABEL: llzk.func @assert_with_message
//CHECK-SAME:  (%[[A:[0-9a-zA-Z_\.]+]]: i1) -> i1 {
//CHECK-NEXT:    %[[T0:[0-9a-zA-Z_\.]+]] = assert %[[A]], "Expected a `true` value" : !llzk.felt
//CHECK-NEXT:    return %[[A]] : i1
//CHECK-NEXT:  }
