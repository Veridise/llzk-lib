// RUN: llzk-opt -split-input-file %s 2>&1 | FileCheck %s

module attributes {veridise.lang = "llzk"} {
  llzk.struct @ComponentA1<[@A, @B]> {
    field @f1 : !llzk.felt

    func @compute(%p: !llzk.felt) -> !llzk.struct<@ComponentA1> {
      %self = new_struct : !llzk.struct<@ComponentA1>
      return %self : !llzk.struct<@ComponentA1>
    }
    func @constrain(%self: !llzk.struct<@ComponentA1>, %p: !llzk.felt) { return }
  }

  llzk.struct @ComponentA2<[@C]> {
    field @f2 : !llzk.felt
    field @f3 : !llzk.struct<@ComponentA1<[5,@C]>>

    func @compute() -> !llzk.struct<@ComponentA2> {
      %self = new_struct : !llzk.struct<@ComponentA2>
      return %self : !llzk.struct<@ComponentA2>
    }

    func @constrain(%self: !llzk.struct<@ComponentA2>) {
      %a = readf %self[@f2] : !llzk.struct<@ComponentA2>, !llzk.felt
      %b = readf %self[@f3] : !llzk.struct<@ComponentA2>, !llzk.struct<@ComponentA1<[5,@C]>>
      call @ComponentA1::@constrain(%b, %a) : (!llzk.struct<@ComponentA1<[5,@C]>>, !llzk.felt) -> ()
      return
    }
  }
}
